<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>有占位</title>
    <link rel="stylesheet" href="../css/index.css">
    <script src="../libs/mvvm.js"></script>

</head>

<body>
    <div class="opation">
        <h1>demo1</h1>
        <div class="btnGroup ">
            <button onclick="checkInView('#wrap','wrapInView','#cover')">点击 检查#wrap是否在可视区</button>
            <div class="btn">

                <span v-data="wrapInView">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            <button onclick="checkInView('#label','labelInView','#cover')">点击 检查#label是否在可视区</button>
            <div class="btn">

                <span v-data="labelInView">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            <button onclick="checkInDomView('#label','#wrap','labelInWrapView')">点击 检查#label是否
                在#wrap可视区内</button>

            <label>
                <input type="radio" name="labelInWrapView" checked value="1">
                完全</label>
            <label>
                <input type="radio" name="labelInWrapView" value="2">
                部分</label>
            <p>


            <div class="btn">
                <span v-data="labelInWrapView">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            旋转： <label>
                <input type="radio" name="labelInWrapViewRotate" checked value="0">
                0</label>
            <label>
                <input type="radio" name="labelInWrapViewRotate" value="-90">
                -90</label>
            <label>
                <input type="radio" name="labelInWrapViewRotate" value="90">
                90</label>
            </p>
            <span style="margin-left:10px;">目前旋转角度:</span><span v-data="wrapView1Rotate">-</span>
            <button onClick="demo1Rotate('#wrap','labelInWrapViewRotate','wrapView1Rotate')">确认旋转</button>
        </div>
        <div>
            不计算#cover在内，也就是被#cover遮住 <span class="warning">没事</span>
            <div class="btnGroup ">
                <button
                    onclick="getDomToVisibleDis('#wrap',window,'wrapToVisibleDis',null,'wrapView1Rotate')">获取#wrap到可视区的距离</button>
                <span v-data="wrapToVisibleDis">--</span>
                <button onclick="windowScroll('wrapToVisibleDis')">让#wrap进入窗口可视区</button>
            </div>
        </div>
        <div>
            计算#cover在内，也就是被#cover遮住 <span class="warning">不行</span>
            <div class="btnGroup ">
                <button
                    onclick="getDomToVisibleDis('#wrap',window,'wrapToVisibleDisCover','#cover','wrapView1Rotate')">获取#wrap到可视区的距离</button>
                <span v-data="wrapToVisibleDisCover">--</span>
                <button onclick="windowScroll('wrapToVisibleDisCover')">让#wrap进入窗口可视区</button>
            </div>
        </div>





        <h1>demo2</h1>
        <div class="btnGroup ">
            <button onclick="checkInView('#wrap2','wrapInView2')">点击 检查#wrap2是否在可视区</button>
            <div class="btn">
                <span v-data="wrapInView2">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            <button onclick="checkInView('#label2','labelInView2')">点击 检查#label2是否在可视区</button>
            <div class="btn">

                <span v-data="labelInView2">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            <button onclick="checkInDomView('#label2','#wrap2','labelInWrapView2','#cover2')">点击
                检查#label2是否在#wrap可视区内</button>
            <label>
                <input type="radio" name="labelInWrapView2" checked value="1" onChange="">
                完全</label>
            <label>
                <input type="radio" name="labelInWrapView2" value="2">
                部分</label>
            <div class="btn">
                <span v-data="labelInWrapView2">--</span>
            </div>
        </div>
        <div class="btnGroup ">
            旋转： <label>
                <input type="radio" name="wrapView2Rotate" checked value="0">
                0</label>
            <label>
                <input type="radio" name="wrapView2Rotate" value="-90">
                -90</label>
            <label>
                <input type="radio" name="wrapView2Rotate" value="90">
                90</label>
            </p>
            <span style="margin-left:10px;">目前旋转角度:</span><span v-data="wrapView2Rotate">-</span>
            <button onClick="demo1Rotate('#wrap2','wrapView2Rotate','wrapView2Rotate')">确认旋转</button>
        </div>

        <div>
            不计算#cover2在内，也就是被#cover2遮住 <span class="warning">没事</span>
            <div class="btnGroup ">
                <button
                    onclick="getDomToDomVisibleDis('#label2','#boxInner','labelToVisibleDis',null,'wrapView2Rotate')">获取#label2到#boxInner可视区的距离</button>
                Y距离：
                <span v-data="labelToVisibleDis">--</span> X距离：
                <span v-data="labelToVisibleDisX">--</span>
                <button onclick="domScroll('#boxInner','labelToVisibleDis')">让#label2进入窗口可视区</button>
            </div>
        </div>
        <div>
            计算#cover在内，也就是被#cover遮住 <span class="warning">不行</span>
            <div class="btnGroup ">
                <button
                    onclick="getDomToDomVisibleDis('#label2','#boxInner','labelToVisibleDisCover','#cover2','wrapView2Rotate')">获取#label2到#boxInner可视区的距离</button>
                Y距离: <span v-data="labelToVisibleDisCover">--</span> X距离: <span
                    v-data="labelToVisibleDisCoverX">--</span>
                <button onclick="domScroll('#boxInner','labelToVisibleDisCover')">让#label2进入窗口可视区</button>
            </div>
        </div>
        <h1>demo3 让#wrap 进入窗口可视区</h1>
        <button onclick="letWrapInWinView()">点击</button>
    </div>

    <h1>demo1</h1>
    <div class="wrap" id="wrap">
        <div class="inner ">
            这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问， 这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，诸如：成书何时？如何成书？作者是谁？
            <span class="label label-blue" id="label">#label</span>有几？
            据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。
        </div>
    </div>
    <div style="height:200px"></div>
    <h1>demo2 dom 元素 底部有覆盖</h1>
    <div class="wrap wrap2" id="wrap2" style="overflow: hidden;padding:0;">
        <div class="boxInner" id="boxInner" style="height:100%;overflow: auto;    overflow: overlay;z-index:1;">
            <div class="inner inner">
                实在奇。奇
                这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，
                这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，诸如：成书何时？如何成书？作者是谁？ 这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，
                这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，诸如：成书何时？如何成书？作者是谁？ 这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，
                这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，诸如：成书何时？如何成书？作者是谁？
                <span class="label label-blue" id="label2">#label2</span>有几？
                据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。据现存最早的《金瓶梅》序言说，作者叫“兰陵笑笑生”。这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，这部书，实在奇。奇就奇在一照面便给人们留下了一大堆疑问，可是这位兰陵笑笑生究竟是谁？姓谁名谁，无从考证，明代人就众说纷纭。即使到了如今，众多学者和专家也无法考证这位兰陵笑笑生是谁。推断很多，但是都缺实证，因此，这位兰陵笑笑生也还在云里雾里。
            </div>
        </div>
        <div class="cover2" id="cover2"></div>
    </div>
    <div class="fixed" id="cover"></div>
    <script src="../js/inViewUtils.js">
    </script>
    <script src="../libs/mvvm.js"></script>
    <script>
        var state = {
            wrapInView: false, //#wrap是否在可视区
            labelInView: false, //#label是否在可视区内
            labelInWrapView: false, //#label是否在#wrap可视区内
            wrapView1Rotate: 0,
            wrapToVisibleDis: "--", //#wrap到可视区的距离
            wrapToVisibleDisCover: "-", //#wrap到可视区的距离,计算遮罩无

            wrapInView2: false, //#wrap是否在可视区
            wrapView2Rotate: 0,
            labelInView2: false, //#label是否在可视区内
            labelInWrapView2: false, //#label2是否在#wrap可视区内
            labelToVisibleDis: "--", //#label2到可视区的Y距离
            labelToVisibleDisX: "--", //#label2到可视区的X距离
            labelToVisibleDisCover: "-", //#label2到可视区的距离,计算遮罩无
            labelToVisibleDisCoverX: "-", //#label2到可视区的距离,计算遮罩无
        };
        var vm = MVVM(state);
        window.onload = function () {
            //检查是否在视图
            checkInView('#wrap', 'wrapInView');
            checkInView('#label', 'labelInView');

            checkInView('#wrap2', 'wrapInView2');
            checkInView('#label2', 'labelInView2');
        }
        //旋转dom
        var demo1Rotate = function (domID, radiousname, varName) {
            var doms = document.querySelectorAll(`input[type=radio][name=${radiousname}]`);
            Array.from(doms).forEach(item => {
                if (item.checked === true) {
                    vm[varName] = item.value;
                }
            })
            document.querySelector(domID).style.cssText = `
                transform: rotate(${vm[varName]}deg);
            `;
        }
        //检查是否在浏览器可视区
        function checkInView(dom, varName, coverId) {
            console.warn("check dom:", document.querySelector(dom))
            var coverDom = document.querySelector(coverId);
            var coverHeight = coverDom ? coverDom.getBoundingClientRect().height : 0;

            let inView = inViewUtils.isInView({
                dom: document.querySelector(dom),
                otherHeight: coverHeight
            });
            console.log("inView:", dom, inView);
            vm[varName] = inView;
        }
        //检查是否在dom的可视区内
        function checkInDomView(dom, wrapDom, varName, coverId) {
            var radiosDom = document.querySelectorAll(`input[type=radio][name=${varName}]`);
            var coverDom = document.querySelector(coverId);
            var coverHeight = coverDom ? coverDom.getBoundingClientRect().height : 0;
            console.log("coverDom", coverDom)
            var overallVisible = true;
            Array.from(radiosDom).forEach(item => {
                if (item.checked === true) {
                    console.log("item", item)
                    overallVisible = item.value == 1 ? true : false;
                }
            })
            let inView = inViewUtils.isInDomView({
                dom: document.querySelector(dom),
                wrapDom: document.querySelector(wrapDom),
                overallVisible: overallVisible,
                otherHeight: coverHeight

            });
            vm[varName] = inView;
        }

        //获取dom到窗口可视区的距离
        //'#wrap',window,'wrapToVisibleDis',"#cover"
        function getDomToVisibleDis(dom, viewProt, varName, coverDom, rotateVarName) {

            var coverHeight = document.querySelector(coverDom) ? inViewUtils.getBlockHeight(document.querySelector(coverDom)) : 0;

            let dis = inViewUtils.getDomToVisbleDis({ dom: document.querySelector(dom), viewPort: viewProt, yOtherHeight: coverHeight, rotate: rotateVarName });
            vm[varName] = dis;
            console.log("View", dis)
        }
        //检测dom在容器dom内到可视区的距离
        function getDomToDomVisibleDis(dom, domSeleterString, varName, coverDom, rotateVarName) {

            var coverHeight = coverDom ? inViewUtils.getBlockHeight(document.querySelector(coverDom)) : 0;
            var viewProt = document.querySelector(domSeleterString);

            let dis = inViewUtils.getDomToVisbleDis({
                dom: document.querySelector(dom),
                viewPort: viewProt,
                yOtherHeight: coverHeight,
                rotate: vm[rotateVarName]
            });
            console.log("dis=======", dis)
            vm[varName] = dis.y;
            vm[varName + "X"] = dis.x;

        }
        //让窗口滚动到指定距离
        function windowScroll(varName) {
            window.scrollBy(0, vm[varName])
        }

        function domScroll(wrapSeleter, varName) {
            var wrap = document.querySelector(wrapSeleter);
            console.log("wrap", wrap, "xx", vm[varName])
            let x = vm[varName + "X"] ? vm[varName + "X"] : 0;
            wrap.scrollBy(x, vm[varName]);
        }
        //让#wrap进入窗口视图
        function letWrapInWinView() {
            let wrap = document.querySelector("#wrap");
            let disObj = inViewUtils.getDomToViewVisbleDis({ dom: wrap });
            console.log("disObj", disObj)
            window.scrollBy(disObj.x, disObj.y)
        }
    </script>
</body>

</html>